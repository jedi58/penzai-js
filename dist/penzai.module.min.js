window.penzai=function(e,t={}){e.classList.add("penzai"),e.setAttribute("role","tree");const c={checkboxes:!0,...t};function r(e){const t=e.querySelector(":scope > ul, :scope > ol"),l=Boolean(t);e.setAttribute("role","treeitem"),e.setAttribute("tabindex","-1"),l&&e.setAttribute("aria-expanded","false");const i=document.createElement("span");let o;i.className="penzai-disclosure",e.prepend(i),c.checkboxes&&(o=document.createElement("input"),o.type="checkbox",o.className="penzai-checkbox",e.prepend(o),o.addEventListener("change",(()=>function(e,t){e.querySelectorAll(":scope ul input[type=checkbox], :scope ol input[type=checkbox]").forEach((e=>{e.checked=t,e.indeterminate=!1})),a(e.parentElement.closest("li"))}(e,o.checked)))),l?(t.setAttribute("role","group"),i.addEventListener("click",(t=>{t.stopPropagation(),n(e)})),t.querySelectorAll(":scope > li").forEach(r)):e.classList.add("penzai-leaf")}function n(e){const t="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",String(!t))}function a(e){if(!e)return;const t=e.querySelectorAll(":scope > ul > li > input[type=checkbox], :scope > ol > li > input[type=checkbox]"),c=e.querySelector(":scope > input[type=checkbox]");if(!c)return;const r=[...t].filter((e=>e.checked)).length;0===r?(c.checked=!1,c.indeterminate=!1):r===t.length?(c.checked=!0,c.indeterminate=!1):(c.checked=!1,c.indeterminate=!0),a(e.parentElement.closest("li"))}e.addEventListener("keydown",(t=>{const c=document.activeElement.closest("li");if(c&&e.contains(c))switch(t.key){case"ArrowRight":"false"===c.getAttribute("aria-expanded")&&n(c);break;case"ArrowLeft":"true"===c.getAttribute("aria-expanded")&&n(c);break;case"ArrowDown":c.nextElementSibling?.focus();break;case"ArrowUp":c.previousElementSibling?.focus();break;case" ":c.querySelector("input[type=checkbox]")?.click(),t.preventDefault()}})),e.querySelectorAll(":scope > li").forEach(r),e.querySelector("li")?.setAttribute("tabindex","0");const l={update(){e.querySelectorAll(".penzai-disclosure, .penzai-checkbox").forEach((e=>e.remove())),e.querySelectorAll(":scope > li").forEach(r)},expandAll(){e.querySelectorAll("li[aria-expanded]").forEach((e=>e.setAttribute("aria-expanded","true")))},collapseAll(){e.querySelectorAll("li[aria-expanded]").forEach((e=>e.setAttribute("aria-expanded","false")))}};return t.expandAll&&l.expandAll(),l};
